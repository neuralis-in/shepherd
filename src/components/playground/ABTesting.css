/* ========================================
   A/B TESTING COMPONENT - NEW LAYOUT
   Fixed Sidebar + Main Content + Bottom Nav
   ======================================== */

.ab-testing-layout {
  display: grid;
  grid-template-columns: 220px 1fr;
  grid-template-rows: 1fr auto;
  height: calc(100vh - 140px);
  min-height: 400px;
  background: var(--color-bg);
  border: 1px solid var(--color-border);
  border-radius: var(--radius-lg);
  overflow: hidden;
}

/* ========================================
   SIDEBAR - Fixed Left
   ======================================== */

.ab-sidebar {
  grid-row: 1 / 3;
  display: flex;
  flex-direction: column;
  background: var(--color-bg-secondary);
  border-right: 1px solid var(--color-border);
}

.ab-sidebar__header {
  display: flex;
  align-items: center;
  gap: var(--spacing-sm);
  padding: var(--spacing-md);
  border-bottom: 1px solid var(--color-border);
  font-size: 0.875rem;
  font-weight: 600;
  color: var(--color-text);
}

.ab-sidebar__header svg {
  color: var(--color-accent);
}

/* Sidebar Navigation */
.ab-sidebar__nav {
  flex: 1;
  padding: var(--spacing-sm);
  overflow-y: auto;
}

.ab-sidebar__step {
  display: flex;
  align-items: center;
  gap: var(--spacing-sm);
  width: 100%;
  padding: 0.625rem 0.75rem;
  margin-bottom: 0.125rem;
  background: transparent;
  border: none;
  border-radius: var(--radius-md);
  cursor: pointer;
  text-align: left;
  transition: all var(--transition-fast);
}

.ab-sidebar__step:hover:not(:disabled) {
  background: var(--color-bg-subtle);
}

.ab-sidebar__step--active {
  background: var(--color-bg);
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);
}

.ab-sidebar__step--completed {
  opacity: 0.85;
}

.ab-sidebar__step--completed:hover:not(:disabled) {
  opacity: 1;
}

.ab-sidebar__step--disabled {
  opacity: 0.4;
  cursor: not-allowed;
}

.ab-sidebar__step-icon {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 28px;
  height: 28px;
  background: var(--color-bg);
  border: 1px solid var(--color-border);
  border-radius: var(--radius-sm);
  color: var(--color-text-muted);
  flex-shrink: 0;
}

.ab-sidebar__step--active .ab-sidebar__step-icon {
  background: var(--color-accent);
  border-color: var(--color-accent);
  color: white;
}

.ab-sidebar__step--completed .ab-sidebar__step-icon {
  background: rgba(16, 185, 129, 0.1);
  border-color: #10B981;
  color: #10B981;
}

.ab-sidebar__step-content {
  flex: 1;
  min-width: 0;
}

.ab-sidebar__step-label {
  display: block;
  font-size: 0.8125rem;
  font-weight: 500;
  color: var(--color-text);
}

.ab-sidebar__step--disabled .ab-sidebar__step-label {
  color: var(--color-text-muted);
}

.ab-sidebar__step-desc {
  display: block;
  font-size: 0.625rem;
  color: var(--color-text-muted);
  margin-top: 1px;
}

.ab-sidebar__step-indicator {
  color: var(--color-accent);
  flex-shrink: 0;
}

/* Sidebar Status */
.ab-sidebar__status {
  padding: var(--spacing-sm) var(--spacing-md);
  border-top: 1px solid var(--color-border);
  display: flex;
  flex-wrap: wrap;
  gap: 0.375rem;
}

.ab-sidebar__status-item {
  display: flex;
  align-items: center;
  gap: 0.25rem;
  font-size: 0.625rem;
  color: var(--color-text-secondary);
  padding: 0.1875rem 0.375rem;
  background: var(--color-bg);
  border-radius: var(--radius-xs);
}

.ab-sidebar__status-badge {
  width: 14px;
  height: 14px;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: 3px;
  font-size: 0.5rem;
  font-weight: 700;
  color: white;
}

.ab-sidebar__status-badge--a {
  background: var(--color-accent);
}

.ab-sidebar__status-badge--b {
  background: #6366F1;
}

/* Hide old sidebar actions - we use bottom bar now */
.ab-sidebar__actions {
  display: none;
}

/* ========================================
   MAIN CONTENT
   ======================================== */

.ab-main {
  display: flex;
  flex-direction: column;
  overflow: hidden;
  min-height: 0;
}

.ab-main__header {
  padding: var(--spacing-sm) var(--spacing-lg);
  border-bottom: 1px solid var(--color-border);
  background: var(--color-bg);
  flex-shrink: 0;
}

.ab-main__title {
  font-size: 1rem;
  font-weight: 600;
  color: var(--color-text);
  margin: 0 0 0.125rem 0;
}

.ab-main__desc {
  font-size: 0.75rem;
  color: var(--color-text-muted);
  margin: 0;
}

.ab-main__content {
  flex: 1;
  padding: var(--spacing-md) var(--spacing-lg);
  overflow-y: auto;
  min-height: 0;
}

/* ========================================
   BOTTOM NAVIGATION BAR
   ======================================== */

.ab-bottom-nav {
  grid-column: 2;
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: var(--spacing-sm) var(--spacing-lg);
  background: var(--color-bg);
  border-top: 1px solid var(--color-border);
}

.ab-bottom-nav__left,
.ab-bottom-nav__right {
  display: flex;
  align-items: center;
  gap: var(--spacing-sm);
}

.ab-bottom-nav__btn {
  display: flex;
  align-items: center;
  gap: 0.375rem;
  padding: 0.5rem 1rem;
  font-size: 0.8125rem;
  font-weight: 500;
  border-radius: var(--radius-md);
  cursor: pointer;
  transition: all var(--transition-fast);
  border: none;
}

.ab-bottom-nav__btn--back {
  background: var(--color-bg-secondary);
  color: var(--color-text-secondary);
  border: 1px solid var(--color-border);
}

.ab-bottom-nav__btn--back:hover {
  background: var(--color-bg-subtle);
  color: var(--color-text);
}

.ab-bottom-nav__btn--next {
  background: var(--color-accent);
  color: white;
  padding: 0.5rem 1.25rem;
}

.ab-bottom-nav__btn--next:hover:not(:disabled) {
  background: var(--color-accent-hover);
}

.ab-bottom-nav__btn--next:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

.ab-bottom-nav__btn--reset {
  background: var(--color-bg-secondary);
  color: var(--color-text-secondary);
  border: 1px solid var(--color-border);
}

.ab-bottom-nav__btn--reset:hover {
  background: var(--color-bg-subtle);
  color: var(--color-text);
}

.ab-bottom-nav__btn--run {
  background: var(--color-accent);
  color: white;
  padding: 0.5rem 1.5rem;
  font-weight: 600;
}

.ab-bottom-nav__btn--run:hover {
  background: var(--color-accent-hover);
}

.ab-bottom-nav__status {
  font-size: 0.75rem;
  color: var(--color-text-muted);
}

/* Keep old class for backwards compatibility */
.ab-testing {
  display: flex;
  flex-direction: column;
  gap: var(--spacing-md);
}

/* Remove old stepper styles - keeping minimal for reference */
.ab-stepper__content {
  display: flex;
  flex-direction: column;
  gap: 2px;
  min-width: 0;
}

.ab-stepper__label {
  font-size: 0.8125rem;
  font-weight: 600;
  color: var(--color-text);
  white-space: nowrap;
}

.ab-stepper__step--disabled .ab-stepper__label {
  color: var(--color-text-muted);
}

.ab-stepper__desc {
  font-size: 0.6875rem;
  color: var(--color-text-muted);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.ab-stepper__connector {
  flex: 1;
  height: 2px;
  background: var(--color-border);
  margin: 0 var(--spacing-sm);
  border-radius: 1px;
  min-width: 20px;
}

.ab-stepper__step--completed + .ab-stepper__step .ab-stepper__connector,
.ab-stepper__step--completed .ab-stepper__connector {
  background: var(--color-accent);
}

/* ========================================
   STEP CONTENT
   ======================================== */

.ab-step-content {
  min-height: 280px;
}

/* ========================================
   PIPELINE SELECTION (STEP 1)
   ======================================== */

.ab-pipelines-grid {
  display: grid;
  grid-template-columns: 1fr auto 1fr;
  gap: var(--spacing-md);
  align-items: start;
}

.ab-pipelines-divider {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: var(--spacing-xs);
  padding: var(--spacing-lg) var(--spacing-md);
  color: var(--color-text-muted);
}

.ab-pipelines-divider span {
  font-size: 0.75rem;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.05em;
}

/* Pipeline Selector */
.ab-pipeline-selector {
  background: var(--color-bg);
  border: 1px solid var(--color-border);
  border-radius: var(--radius-lg);
  padding: var(--spacing-md);
  transition: all var(--transition-base);
}

.ab-pipeline-selector--active {
  border-color: var(--color-accent);
}

.ab-pipeline-selector__header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: var(--spacing-sm);
}

.ab-pipeline-selector__title {
  display: flex;
  align-items: center;
  gap: var(--spacing-xs);
}

.ab-pipeline-selector__badge {
  font-size: 0.75rem;
  font-weight: 600;
  color: var(--color-text);
  background: var(--color-bg-subtle);
  padding: 0.25rem 0.625rem;
  border-radius: var(--radius-sm);
  border: 1px solid var(--color-border);
}

.ab-pipeline-selector__count {
  font-size: 0.75rem;
  color: var(--color-text-muted);
}

.ab-pipeline-selector__clear {
  display: flex;
  align-items: center;
  gap: 4px;
  padding: 0.25rem 0.5rem;
  font-size: 0.6875rem;
  font-weight: 500;
  color: var(--color-text-muted);
  background: transparent;
  border: none;
  border-radius: var(--radius-sm);
  cursor: pointer;
  transition: all var(--transition-fast);
}

.ab-pipeline-selector__clear:hover {
  color: var(--color-text);
  background: var(--color-bg-subtle);
}

.ab-pipeline-selector__labels {
  display: flex;
  flex-wrap: wrap;
  gap: var(--spacing-xs);
}

/* Label Filter */
.ab-label-filter {
  position: relative;
}

.ab-label-filter__trigger {
  display: flex;
  align-items: center;
  gap: 0.375rem;
  padding: 0.375rem 0.625rem;
  font-size: 0.75rem;
  font-weight: 500;
  color: var(--color-text-secondary);
  background: var(--color-bg);
  border: 1px solid var(--color-border);
  border-radius: var(--radius-sm);
  cursor: pointer;
  transition: all var(--transition-fast);
}

.ab-label-filter__trigger:hover {
  border-color: var(--color-text-muted);
}

.ab-label-filter__trigger--active {
  background: var(--color-bg-subtle);
  border-color: var(--color-accent);
  color: var(--color-text);
}

.ab-label-filter__name {
  max-width: 100px;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.ab-label-filter__selected {
  display: flex;
  align-items: center;
  justify-content: center;
  min-width: 16px;
  height: 16px;
  background: var(--color-accent);
  color: white;
  font-size: 0.625rem;
  font-weight: 600;
  border-radius: var(--radius-sm);
  padding: 0 4px;
}

.ab-label-filter__chevron {
  transition: transform var(--transition-fast);
}

.ab-label-filter__chevron--open {
  transform: rotate(180deg);
}

/* Label Dropdown */
.ab-label-dropdown {
  position: absolute;
  top: calc(100% + 4px);
  left: 0;
  min-width: 180px;
  max-width: 240px;
  background: var(--color-bg);
  border: 1px solid var(--color-border);
  border-radius: var(--radius-md);
  box-shadow: var(--shadow-lg);
  z-index: 100;
  overflow: hidden;
}

.ab-label-dropdown__header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 0.625rem 0.75rem;
  background: var(--color-bg-subtle);
  border-bottom: 1px solid var(--color-border);
  font-size: 0.75rem;
  font-weight: 600;
  color: var(--color-text);
}

.ab-label-dropdown__clear {
  font-size: 0.6875rem;
  font-weight: 500;
  color: var(--color-accent);
  background: transparent;
  border: none;
  cursor: pointer;
}

.ab-label-dropdown__clear:hover {
  text-decoration: underline;
}

.ab-label-dropdown__options {
  max-height: 200px;
  overflow-y: auto;
  padding: 0.375rem;
}

.ab-label-option {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  width: 100%;
  padding: 0.5rem 0.625rem;
  font-size: 0.8125rem;
  color: var(--color-text);
  background: transparent;
  border: none;
  border-radius: var(--radius-sm);
  cursor: pointer;
  text-align: left;
  transition: background var(--transition-fast);
}

.ab-label-option:hover {
  background: var(--color-bg-subtle);
}

.ab-label-option--selected {
  background: var(--color-bg-subtle);
}

.ab-label-option__checkbox {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 16px;
  height: 16px;
  background: var(--color-bg);
  border: 1px solid var(--color-border);
  border-radius: var(--radius-sm);
  flex-shrink: 0;
  transition: all var(--transition-fast);
}

.ab-label-option--selected .ab-label-option__checkbox {
  background: var(--color-accent);
  border-color: var(--color-accent);
  color: white;
}

.ab-label-option__text {
  flex: 1;
  min-width: 0;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

/* Selected Labels Summary */
.ab-pipeline-selector__summary {
  display: flex;
  flex-wrap: wrap;
  gap: 0.375rem;
  margin-top: var(--spacing-sm);
  padding-top: var(--spacing-sm);
  border-top: 1px solid var(--color-border);
}

.ab-label-chip {
  display: inline-flex;
  align-items: center;
  gap: 0.375rem;
  padding: 0.25rem 0.5rem;
  font-size: 0.6875rem;
  font-weight: 500;
  color: var(--color-text);
  background: var(--color-bg-subtle);
  border: 1px solid var(--color-border);
  border-radius: var(--radius-sm);
}

.ab-label-chip button {
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 0;
  background: transparent;
  border: none;
  color: var(--color-text-muted);
  cursor: pointer;
  opacity: 0.7;
  transition: opacity var(--transition-fast);
}

.ab-label-chip button:hover {
  opacity: 1;
}

/* Overlap Preview */
.ab-overlap-preview {
  display: flex;
  align-items: center;
  gap: var(--spacing-xs);
  margin-top: var(--spacing-md);
  padding: 0.75rem 1rem;
  background: var(--color-bg);
  border: 1px solid var(--color-border);
  border-radius: var(--radius-md);
  font-size: 0.875rem;
  color: var(--color-text-secondary);
}

.ab-overlap-preview svg {
  color: var(--color-text-muted);
}

.ab-overlap-preview strong {
  font-weight: 600;
  color: var(--color-text);
}

.ab-overlap-preview--warning {
  background: #FFFBEB;
  border-color: #FDE68A;
  color: #92400E;
}

.ab-overlap-preview--warning svg {
  color: #D97706;
}

/* ========================================
   GROUP SELECTION (STEP 2)
   ======================================== */

/* Pipeline Stats Summary */
.ab-pipeline-stats {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: var(--spacing-md);
  margin-bottom: var(--spacing-md);
}

.ab-pipeline-stat {
  display: flex;
  flex-direction: column;
  gap: 0.25rem;
  padding: 0.875rem 1rem;
  border-radius: var(--radius-md);
  background: var(--color-bg-secondary);
  border: 1px solid var(--color-border);
}

.ab-pipeline-stat--a {
  border-left: 3px solid var(--color-accent);
}

.ab-pipeline-stat--b {
  border-left: 3px solid var(--color-info);
}

.ab-pipeline-stat__badge {
  font-size: 0.75rem;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.02em;
  color: var(--color-text-muted);
}

.ab-pipeline-stat--a .ab-pipeline-stat__badge {
  color: var(--color-accent);
}

.ab-pipeline-stat--b .ab-pipeline-stat__badge {
  color: var(--color-info);
}

.ab-pipeline-stat__value {
  font-size: 0.9375rem;
  font-weight: 500;
  color: var(--color-text-primary);
}

.ab-pipeline-stat__detail {
  font-size: 0.8125rem;
  color: var(--color-text-secondary);
}

.ab-step2-info {
  display: flex;
  align-items: flex-start;
  gap: var(--spacing-xs);
  padding: 0.75rem 1rem;
  background: var(--color-bg-subtle);
  border: 1px solid var(--color-border);
  border-radius: var(--radius-md);
  margin-bottom: var(--spacing-md);
  font-size: 0.8125rem;
  color: var(--color-text-secondary);
  line-height: 1.5;
}

.ab-step2-info svg {
  flex-shrink: 0;
  margin-top: 2px;
  color: var(--color-text-muted);
}

.ab-groups-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: var(--spacing-md);
  margin-bottom: var(--spacing-md);
}

.ab-groups-search {
  display: flex;
  align-items: center;
  gap: var(--spacing-xs);
  flex: 1;
  max-width: 320px;
  padding: 0.625rem 0.875rem;
  background: var(--color-bg);
  border: 1px solid var(--color-border);
  border-radius: var(--radius-md);
  color: var(--color-text-muted);
  transition: all var(--transition-fast);
}

.ab-groups-search:focus-within {
  border-color: var(--color-accent);
}

.ab-groups-search input {
  flex: 1;
  background: transparent;
  border: none;
  font-size: 0.875rem;
  color: var(--color-text);
  outline: none;
  font-family: inherit;
}

.ab-groups-search input::placeholder {
  color: var(--color-text-muted);
}

.ab-groups-actions {
  display: flex;
  align-items: center;
  gap: var(--spacing-sm);
}

.ab-groups-count {
  font-size: 0.8125rem;
  color: var(--color-text-muted);
}

.ab-groups-select-all {
  padding: 0.5rem 0.75rem;
  font-size: 0.75rem;
  font-weight: 500;
  color: var(--color-text-secondary);
  background: var(--color-bg-subtle);
  border: 1px solid var(--color-border);
  border-radius: var(--radius-sm);
  cursor: pointer;
  transition: all var(--transition-fast);
  font-family: inherit;
}

.ab-groups-select-all:hover {
  background: var(--color-border);
  color: var(--color-text);
}

/* Groups List */
.ab-groups-list {
  display: flex;
  flex-direction: column;
  gap: var(--spacing-sm);
  max-height: 400px;
  overflow-y: auto;
}

.ab-groups-empty {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: var(--spacing-sm);
  padding: var(--spacing-xl) var(--spacing-md);
  color: var(--color-text-muted);
  text-align: center;
  background: var(--color-bg);
  border: 1px solid var(--color-border);
  border-radius: var(--radius-lg);
}

.ab-groups-empty svg {
  opacity: 0.5;
}

/* Groups Section */
.ab-groups-section {
  margin-bottom: var(--spacing-md);
}

.ab-groups-section__header {
  display: flex;
  align-items: center;
  gap: var(--spacing-xs);
  padding: 0.5rem 0;
  font-size: 0.8125rem;
  font-weight: 600;
  color: var(--color-text);
  border-bottom: 1px solid var(--color-border);
  margin-bottom: var(--spacing-sm);
}

.ab-groups-section__header svg {
  color: #10B981;
}

.ab-groups-section--non-overlapping .ab-groups-section__header svg {
  color: var(--color-text-muted);
}

.ab-groups-section__desc {
  font-size: 0.75rem;
  color: var(--color-text-muted);
  margin: 0 0 var(--spacing-sm);
}

/* Prompt Group Card */
.ab-prompt-group {
  background: var(--color-bg);
  border: 1px solid var(--color-border);
  border-radius: var(--radius-lg);
  margin-bottom: var(--spacing-sm);
  transition: all var(--transition-base);
  overflow: hidden;
}

.ab-prompt-group:hover {
  border-color: var(--color-text-muted);
}

.ab-prompt-group--selected {
  border-color: var(--color-accent);
}

.ab-prompt-group__header {
  display: flex;
  align-items: center;
  gap: var(--spacing-sm);
  padding: 0.875rem var(--spacing-md);
  cursor: pointer;
}

.ab-prompt-group__checkbox {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 18px;
  height: 18px;
  background: var(--color-bg);
  border: 1px solid var(--color-border);
  border-radius: var(--radius-sm);
  flex-shrink: 0;
  transition: all var(--transition-fast);
}

.ab-prompt-group--selected .ab-prompt-group__checkbox {
  background: var(--color-accent);
  border-color: var(--color-accent);
  color: white;
}

.ab-prompt-group__info {
  flex: 1;
  min-width: 0;
  display: flex;
  flex-direction: column;
  gap: 0.375rem;
}

.ab-prompt-group__title-row {
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

.ab-prompt-group__title-row svg {
  color: var(--color-text-muted);
  flex-shrink: 0;
}

.ab-prompt-group__api {
  font-size: 0.875rem;
  font-weight: 600;
  color: var(--color-text);
}

.ab-prompt-group__model {
  font-size: 0.6875rem;
  font-family: var(--font-mono);
  color: var(--color-text-muted);
  background: var(--color-bg-subtle);
  padding: 0.125rem 0.5rem;
  border-radius: var(--radius-sm);
  border: 1px solid var(--color-border);
}

.ab-prompt-group__system-preview {
  display: flex;
  align-items: flex-start;
  gap: 0.375rem;
  font-size: 0.75rem;
  color: var(--color-text-muted);
  line-height: 1.4;
}

.ab-prompt-group__system-preview svg {
  flex-shrink: 0;
  margin-top: 2px;
  color: #F59E0B;
}

.ab-prompt-group__stats {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  flex-shrink: 0;
}

.ab-prompt-group__stat {
  display: flex;
  align-items: center;
  gap: 0.25rem;
  padding: 0.25rem 0.5rem;
  background: var(--color-bg-subtle);
  border: 1px solid var(--color-border);
  border-radius: var(--radius-sm);
}

.ab-prompt-group__stat-label {
  font-size: 0.625rem;
  font-weight: 600;
  color: var(--color-text-muted);
}

.ab-prompt-group__stat-value {
  font-size: 0.75rem;
  font-weight: 600;
  font-family: var(--font-mono);
  color: var(--color-text);
}

.ab-prompt-group__expand {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 24px;
  height: 24px;
  background: var(--color-bg-subtle);
  border: 1px solid var(--color-border);
  border-radius: var(--radius-sm);
  color: var(--color-text-muted);
  cursor: pointer;
  transition: all var(--transition-fast);
  flex-shrink: 0;
}

.ab-prompt-group__expand:hover {
  background: var(--color-border);
  color: var(--color-text);
}

/* Prompt Group Details */
.ab-prompt-group__details {
  border-top: 1px solid var(--color-border);
}

.ab-prompt-group__system {
  padding: var(--spacing-md);
  background: #FFFBEB;
  border-bottom: 1px solid var(--color-border);
}

.ab-prompt-group__system-header {
  display: flex;
  align-items: center;
  gap: 0.375rem;
  font-size: 0.6875rem;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.05em;
  color: #92400E;
  margin-bottom: 0.5rem;
}

.ab-prompt-group__system-text {
  font-size: 0.8125rem;
  line-height: 1.6;
  color: var(--color-text-secondary);
  white-space: pre-wrap;
  word-break: break-word;
}

.ab-prompt-group__comparison-stats {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: var(--spacing-sm);
  padding: var(--spacing-md);
  background: var(--color-bg);
  border-bottom: 1px solid var(--color-border);
}

.ab-prompt-group__cstat {
  display: flex;
  flex-direction: column;
  gap: 0.25rem;
  padding: 0.625rem;
  background: var(--color-bg-subtle);
  border: 1px solid var(--color-border);
  border-radius: var(--radius-sm);
}

.ab-prompt-group__cstat-label {
  font-size: 0.5625rem;
  text-transform: uppercase;
  letter-spacing: 0.05em;
  color: var(--color-text-muted);
}

.ab-prompt-group__cstat-value {
  font-size: 0.8125rem;
  font-weight: 600;
  font-family: var(--font-mono);
  color: var(--color-text);
}

/* Prompt Group Instances */
.ab-prompt-group__instances {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: var(--spacing-md);
  padding: var(--spacing-md);
  background: var(--color-bg);
}

.ab-prompt-group__pipeline-col {
  background: var(--color-bg);
  border: 1px solid var(--color-border);
  border-radius: var(--radius-md);
  overflow: hidden;
}

.ab-prompt-group__col-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 0.625rem 0.75rem;
  background: var(--color-bg-subtle);
  border-bottom: 1px solid var(--color-border);
  font-size: 0.75rem;
  color: var(--color-text-muted);
}

.ab-prompt-group__col-badge {
  font-size: 0.6875rem;
  font-weight: 600;
  padding: 0.25rem 0.5rem;
  border-radius: var(--radius-sm);
}

.ab-prompt-group__col-badge--a {
  background: var(--color-bg);
  color: var(--color-text);
  border: 1px solid var(--color-border);
}

.ab-prompt-group__col-badge--b {
  background: var(--color-bg);
  color: var(--color-text);
  border: 1px solid var(--color-border);
}

.ab-prompt-group__col-list {
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
  padding: var(--spacing-sm);
  max-height: 400px;
  overflow-y: auto;
}

.ab-prompt-group__more {
  font-size: 0.6875rem;
  color: var(--color-text-muted);
  text-align: center;
  padding: 0.5rem;
}

.ab-prompt-group__empty {
  font-size: 0.75rem;
  color: var(--color-text-muted);
  text-align: center;
  padding: var(--spacing-md);
}

/* Instance (matching EnhancePrompts pattern) */
.ab-instance {
  background: var(--color-bg-subtle);
  border: 1px solid var(--color-border);
  border-radius: var(--radius-md);
  padding: 0.75rem;
}

.ab-instance__header {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  margin-bottom: 0.5rem;
}

.ab-instance__num {
  font-size: 0.6875rem;
  font-weight: 600;
  color: var(--color-text);
  background: var(--color-bg);
  padding: 2px 6px;
  border-radius: 4px;
  border: 1px solid var(--color-border);
}

.ab-instance__duration {
  font-size: 0.625rem;
  font-family: var(--font-mono);
  color: var(--color-text-muted);
}

.ab-instance__tokens {
  font-size: 0.625rem;
  font-family: var(--font-mono);
  color: #6366F1;
  background: #EEF2FF;
  padding: 2px 6px;
  border-radius: 4px;
}

.ab-instance__io {
  display: flex;
  align-items: flex-start;
  gap: 0.5rem;
  font-size: 0.75rem;
  line-height: 1.5;
}

.ab-instance__input {
  flex: 1;
  display: flex;
  align-items: flex-start;
  gap: 0.375rem;
  color: var(--color-text-secondary);
  background: var(--color-bg);
  padding: 0.5rem;
  border-radius: var(--radius-sm);
  border: 1px solid var(--color-border);
}

.ab-instance__input svg {
  flex-shrink: 0;
  margin-top: 2px;
  color: #3B82F6;
}

.ab-instance__arrow {
  flex-shrink: 0;
  color: var(--color-text-muted);
  margin-top: 0.5rem;
}

.ab-instance__output {
  flex: 1;
  color: var(--color-text-secondary);
  background: #F0FDF4;
  padding: 0.5rem;
  border-radius: var(--radius-sm);
  border: 1px solid #BBF7D0;
}

/* Group Card */
.ab-group-card {
  background: var(--color-bg);
  border: 1px solid var(--color-border);
  border-radius: var(--radius-lg);
  transition: all var(--transition-base);
  overflow: hidden;
}

.ab-group-card:hover {
  border-color: var(--color-text-muted);
}

.ab-group-card--selected {
  border-color: var(--color-accent);
}

.ab-group-card__header {
  display: flex;
  align-items: center;
  gap: var(--spacing-sm);
  padding: 0.875rem var(--spacing-md);
  cursor: pointer;
}

.ab-group-card__checkbox {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 18px;
  height: 18px;
  background: var(--color-bg);
  border: 1px solid var(--color-border);
  border-radius: var(--radius-sm);
  flex-shrink: 0;
  transition: all var(--transition-fast);
}

.ab-group-card--selected .ab-group-card__checkbox {
  background: var(--color-accent);
  border-color: var(--color-accent);
  color: white;
}

.ab-group-card__icon {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 32px;
  height: 32px;
  background: #ECFDF5;
  border-radius: var(--radius-sm);
  color: #10B981;
  flex-shrink: 0;
}

.ab-group-card__info {
  flex: 1;
  min-width: 0;
  display: flex;
  flex-direction: column;
  gap: 2px;
}

.ab-group-card__name {
  font-size: 0.875rem;
  font-weight: 600;
  color: var(--color-text);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.ab-group-card__api {
  font-size: 0.6875rem;
  font-family: var(--font-mono);
  color: var(--color-text-muted);
}

.ab-group-card__counts {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  flex-shrink: 0;
}

.ab-group-card__count {
  padding: 0.25rem 0.5rem;
  font-size: 0.6875rem;
  font-weight: 600;
  font-family: var(--font-mono);
  border-radius: var(--radius-sm);
}

.ab-group-card__count--p1 {
  background: var(--color-bg-subtle);
  color: var(--color-text);
  border: 1px solid var(--color-border);
}

.ab-group-card__count--p2 {
  background: var(--color-bg-subtle);
  color: var(--color-text);
  border: 1px solid var(--color-border);
}

.ab-group-card__counts {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  flex-shrink: 0;
  flex-wrap: wrap;
}

.ab-group-card__expand {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 24px;
  height: 24px;
  background: var(--color-bg-subtle);
  border: 1px solid var(--color-border);
  border-radius: var(--radius-sm);
  color: var(--color-text-muted);
  cursor: pointer;
  transition: all var(--transition-fast);
  flex-shrink: 0;
}

.ab-group-card__expand:hover {
  background: var(--color-border);
  color: var(--color-text);
}

/* Group Card Details */
.ab-group-card__details {
  border-top: 1px solid var(--color-border);
  overflow: hidden;
}

.ab-group-card__pipeline-traces {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: var(--spacing-md);
  padding: var(--spacing-md);
  background: var(--color-bg-subtle);
}

.ab-group-card__pipeline {
  background: var(--color-bg);
  border: 1px solid var(--color-border);
  border-radius: var(--radius-md);
  padding: 0.75rem;
}

.ab-group-card__pipeline-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 0.625rem;
  font-size: 0.75rem;
  color: var(--color-text-muted);
}

.ab-group-card__pipeline-badge {
  font-size: 0.6875rem;
  font-weight: 600;
  padding: 0.25rem 0.5rem;
  border-radius: var(--radius-sm);
  background: var(--color-bg-subtle);
  color: var(--color-text);
  border: 1px solid var(--color-border);
}

.ab-group-card__pipeline-badge--p1 {
  background: var(--color-bg-subtle);
}

.ab-group-card__pipeline-badge--p2 {
  background: var(--color-bg-subtle);
}

.ab-group-card__trace-list {
  display: flex;
  flex-direction: column;
  gap: 0.375rem;
}

.ab-group-card__trace {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  padding: 0.5rem 0.625rem;
  background: var(--color-bg-subtle);
  border-radius: var(--radius-sm);
  font-size: 0.75rem;
  color: var(--color-text);
}

.ab-group-card__trace svg {
  color: var(--color-text-muted);
  flex-shrink: 0;
}

.ab-group-card__trace span:first-of-type {
  flex: 1;
  min-width: 0;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.ab-group-card__trace-duration {
  font-family: var(--font-mono);
  font-size: 0.6875rem;
  color: var(--color-text-muted);
  flex-shrink: 0;
}

.ab-group-card__trace-more {
  font-size: 0.6875rem;
  color: var(--color-text-muted);
  padding: 0.5rem 0.625rem;
  text-align: center;
  background: var(--color-bg-subtle);
  border-radius: var(--radius-sm);
}

/* Stats Row */
.ab-group-card__stats-row {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: var(--spacing-sm);
  padding: var(--spacing-md);
  background: var(--color-bg);
  border-bottom: 1px solid var(--color-border);
}

.ab-group-card__stat {
  display: flex;
  flex-direction: column;
  gap: 0.25rem;
  padding: 0.75rem;
  background: var(--color-bg-subtle);
  border: 1px solid var(--color-border);
  border-radius: var(--radius-sm);
}

.ab-group-card__stat-label {
  font-size: 0.625rem;
  text-transform: uppercase;
  letter-spacing: 0.05em;
  color: var(--color-text-muted);
}

.ab-group-card__stat-value {
  font-size: 0.875rem;
  font-weight: 600;
  font-family: var(--font-mono);
  color: var(--color-text);
}

/* Traces Comparison */
.ab-group-card__traces-comparison {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: var(--spacing-md);
  padding: var(--spacing-md);
  background: var(--color-bg-subtle);
}

.ab-group-card__pipeline-section {
  background: var(--color-bg);
  border: 1px solid var(--color-border);
  border-radius: var(--radius-md);
  overflow: hidden;
}

.ab-group-card__traces-list {
  display: flex;
  flex-direction: column;
  gap: var(--spacing-sm);
  padding: var(--spacing-sm);
  max-height: 400px;
  overflow-y: auto;
}

.ab-group-card__no-traces {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 0.5rem;
  padding: var(--spacing-lg);
  color: var(--color-text-muted);
  font-size: 0.8125rem;
}

/* Trace Detail */
.ab-trace-detail {
  background: var(--color-bg-subtle);
  border: 1px solid var(--color-border);
  border-radius: var(--radius-md);
  overflow: hidden;
}

.ab-trace-detail__header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 0.5rem 0.75rem;
  background: var(--color-bg);
  border-bottom: 1px solid var(--color-border);
}

.ab-trace-detail__model {
  display: flex;
  align-items: center;
  gap: 0.375rem;
  font-size: 0.75rem;
  font-weight: 600;
  color: var(--color-text);
}

.ab-trace-detail__model svg {
  color: var(--color-text-muted);
}

.ab-trace-detail__meta {
  display: flex;
  align-items: center;
  gap: 0.75rem;
}

.ab-trace-detail__duration {
  font-size: 0.6875rem;
  font-family: var(--font-mono);
  color: var(--color-text-muted);
}

.ab-trace-detail__tokens {
  font-size: 0.6875rem;
  font-family: var(--font-mono);
  color: var(--color-text-muted);
  background: var(--color-bg-subtle);
  padding: 0.125rem 0.375rem;
  border-radius: var(--radius-sm);
}

.ab-trace-detail__content {
  display: flex;
  flex-direction: column;
  gap: 0;
}

.ab-trace-detail__section {
  padding: 0.625rem 0.75rem;
}

.ab-trace-detail__section--input {
  background: var(--color-bg);
  border-bottom: 1px solid var(--color-border);
}

.ab-trace-detail__section--output {
  background: var(--color-bg-subtle);
}

.ab-trace-detail__section-label {
  display: flex;
  align-items: center;
  gap: 0.25rem;
  font-size: 0.625rem;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.05em;
  color: var(--color-text-muted);
  margin-bottom: 0.375rem;
}

.ab-trace-detail__section--input .ab-trace-detail__section-label {
  color: #3B82F6;
}

.ab-trace-detail__section--output .ab-trace-detail__section-label {
  color: #10B981;
}

.ab-trace-detail__text {
  font-size: 0.75rem;
  line-height: 1.5;
  color: var(--color-text-secondary);
  word-break: break-word;
  white-space: pre-wrap;
}

.ab-trace-detail__toggle {
  display: inline-block;
  margin-left: 0.5rem;
  padding: 0;
  font-size: 0.6875rem;
  font-weight: 500;
  color: var(--color-accent);
  background: none;
  border: none;
  cursor: pointer;
  text-decoration: underline;
}

.ab-trace-detail__toggle:hover {
  opacity: 0.8;
}

.ab-trace-detail__arrow {
  display: none;
}

/* ========================================
   EVAL SELECTION (STEP 3)
   ======================================== */

.ab-metrics-section {
  margin-bottom: var(--spacing-lg);
}

.ab-metrics-section__header {
  display: flex;
  align-items: center;
  gap: var(--spacing-xs);
  padding-bottom: var(--spacing-sm);
  margin-bottom: var(--spacing-sm);
  border-bottom: 1px solid var(--color-border);
  font-size: 0.875rem;
  font-weight: 600;
  color: var(--color-text);
}

.ab-metrics-section__header svg {
  color: #10B981;
}

.ab-metrics-section--future .ab-metrics-section__header svg {
  color: var(--color-text-muted);
}

.ab-metrics-section__select-all {
  margin-left: auto;
  padding: 0.25rem 0.625rem;
  font-size: 0.6875rem;
  font-weight: 500;
  color: var(--color-text-secondary);
  background: var(--color-bg);
  border: 1px solid var(--color-border);
  border-radius: var(--radius-sm);
  cursor: pointer;
  transition: all var(--transition-fast);
}

.ab-metrics-section__select-all:hover {
  background: var(--color-bg-subtle);
  color: var(--color-text);
  border-color: var(--color-border-hover);
}

.ab-metrics-section__badge {
  font-size: 0.625rem;
  font-weight: 500;
  color: #10B981;
  background: #ECFDF5;
  padding: 0.25rem 0.5rem;
  border-radius: var(--radius-sm);
  margin-left: auto;
}

.ab-metrics-section__badge--future {
  color: var(--color-text-muted);
  background: var(--color-bg-subtle);
}

.ab-evals-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
  gap: var(--spacing-sm);
}

.ab-evals-grid--disabled {
  opacity: 0.6;
}

.ab-eval-card {
  display: flex;
  align-items: flex-start;
  gap: var(--spacing-sm);
  padding: var(--spacing-md);
  background: var(--color-bg);
  border: 1px solid var(--color-border);
  border-radius: var(--radius-lg);
  cursor: pointer;
  transition: all var(--transition-base);
  text-align: left;
}

.ab-eval-card:hover {
  border-color: var(--color-text-muted);
}

.ab-eval-card--selected {
  border-color: var(--color-accent);
  background: var(--color-bg-subtle);
}

.ab-eval-card--disabled {
  cursor: not-allowed;
  opacity: 0.7;
}

.ab-eval-card--disabled:hover {
  border-color: var(--color-border);
  transform: none;
}

.ab-eval-card__checkbox {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 18px;
  height: 18px;
  background: var(--color-bg);
  border: 1px solid var(--color-border);
  border-radius: var(--radius-sm);
  flex-shrink: 0;
  margin-top: 2px;
  transition: all var(--transition-fast);
}

.ab-eval-card--selected .ab-eval-card__checkbox {
  background: var(--color-accent);
  border-color: var(--color-accent);
  color: white;
}

.ab-eval-card__icon {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 36px;
  height: 36px;
  background: var(--color-bg-subtle);
  border: 1px solid var(--color-border);
  border-radius: var(--radius-md);
  color: var(--color-text-muted);
  flex-shrink: 0;
}

.ab-eval-card--selected .ab-eval-card__icon {
  color: var(--color-accent);
}

.ab-eval-card__content {
  display: flex;
  flex-direction: column;
  gap: 0.25rem;
  flex: 1;
  min-width: 0;
}

.ab-eval-card__label {
  font-size: 0.875rem;
  font-weight: 600;
  color: var(--color-text);
}

.ab-eval-card__desc {
  font-size: 0.75rem;
  color: var(--color-text-muted);
  line-height: 1.4;
}

/* ========================================
   RUN TEST (STEP 4)
   ======================================== */

.ab-test-summary {
  background: var(--color-bg);
  border: 1px solid var(--color-border);
  border-radius: var(--radius-lg);
  padding: var(--spacing-md);
  margin-bottom: var(--spacing-md);
}

.ab-test-summary h4 {
  font-size: 0.875rem;
  font-weight: 600;
  color: var(--color-text);
  margin: 0 0 var(--spacing-md);
}

.ab-test-summary__grid {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: var(--spacing-sm);
}

.ab-test-summary__item {
  display: flex;
  flex-direction: column;
  gap: 0.25rem;
  padding: 0.75rem;
  background: var(--color-bg-subtle);
  border: 1px solid var(--color-border);
  border-radius: var(--radius-md);
}

.ab-test-summary__label {
  font-size: 0.6875rem;
  text-transform: uppercase;
  letter-spacing: 0.05em;
  color: var(--color-text-muted);
}

.ab-test-summary__value {
  font-size: 0.875rem;
  font-weight: 600;
  color: var(--color-text);
}

/* Run Button */
.ab-run-button {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: var(--spacing-xs);
  width: 100%;
  padding: 0.875rem var(--spacing-lg);
  font-size: 0.9375rem;
  font-weight: 500;
  font-family: inherit;
  color: white;
  background: var(--color-accent);
  border: none;
  border-radius: var(--radius-md);
  cursor: pointer;
  transition: all var(--transition-fast);
}

.ab-run-button:hover {
  background: var(--color-accent-hover);
  transform: translateY(-1px);
}

/* Running State */
.ab-test-running {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: var(--spacing-sm);
  padding: var(--spacing-xl) var(--spacing-md);
  text-align: center;
  background: var(--color-bg);
  border: 1px solid var(--color-border);
  border-radius: var(--radius-lg);
}

.ab-test-running__spinner {
  color: var(--color-text-muted);
  animation: spin 1s linear infinite;
}

@keyframes spin {
  from { transform: rotate(0deg); }
  to { transform: rotate(360deg); }
}

.ab-test-running span {
  font-size: 0.9375rem;
  font-weight: 600;
  color: var(--color-text);
}

.ab-test-running p {
  font-size: 0.8125rem;
  color: var(--color-text-muted);
  margin: 0;
}

/* Test Result */
.ab-test-result {
  background: var(--color-bg);
  border: 1px solid var(--color-border);
  border-radius: var(--radius-lg);
  padding: var(--spacing-md);
}

.ab-test-result--error {
  border-color: #FECACA;
  background: #FEF2F2;
}

.ab-test-result__header {
  display: flex;
  align-items: center;
  gap: var(--spacing-xs);
  margin-bottom: var(--spacing-md);
  color: var(--color-text);
}

.ab-test-result__header span {
  font-size: 0.9375rem;
  font-weight: 600;
}

.ab-test-result__id {
  margin-left: auto;
  font-size: 0.6875rem;
  font-family: var(--font-mono);
  padding: 0.25rem 0.5rem;
  background: var(--color-bg-subtle);
  border: 1px solid var(--color-border);
  border-radius: var(--radius-sm);
  color: var(--color-text-muted);
}

.ab-test-result__summary {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: var(--spacing-sm);
}

.ab-test-result__stat {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 0.25rem;
  padding: 0.875rem;
  background: var(--color-bg-subtle);
  border: 1px solid var(--color-border);
  border-radius: var(--radius-md);
}

.ab-test-result__stat--p1 {
  background: var(--color-bg-subtle);
}

.ab-test-result__stat--p2 {
  background: var(--color-bg-subtle);
}

.ab-test-result__stat-value {
  font-size: 1.25rem;
  font-weight: 700;
  font-family: var(--font-mono);
  color: var(--color-text);
}

.ab-test-result__stat-label {
  font-size: 0.6875rem;
  text-transform: uppercase;
  letter-spacing: 0.05em;
  color: var(--color-text-muted);
  text-align: center;
}

.ab-test-result__error {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 0.5rem;
  color: #DC2626;
  text-align: center;
}

.ab-test-result__error svg {
  opacity: 0.8;
}

.ab-test-result__error span {
  font-size: 0.9375rem;
  font-weight: 600;
}

.ab-test-result__error p {
  font-size: 0.8125rem;
  color: var(--color-text-muted);
  margin: 0;
}

/* ========================================
   RESULTS VISUALIZATION
   ======================================== */

.ab-results {
  display: flex;
  flex-direction: column;
  gap: var(--spacing-lg);
}

.ab-results__header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding-bottom: var(--spacing-sm);
  border-bottom: 1px solid var(--color-border);
}

.ab-results__title {
  display: flex;
  align-items: center;
  gap: var(--spacing-xs);
  font-size: 1rem;
  font-weight: 600;
  color: var(--color-text);
}

.ab-results__title svg {
  color: #10B981;
}

.ab-results__calls {
  font-size: 0.75rem;
  color: var(--color-text-muted);
}

.ab-results__overview {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: var(--spacing-lg);
  padding: var(--spacing-md);
  background: var(--color-bg-subtle);
  border: 1px solid var(--color-border);
  border-radius: var(--radius-lg);
}

.ab-results__pipeline-stat {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 0.25rem;
}

.ab-results__pipeline-badge {
  font-size: 0.875rem;
  font-weight: 700;
  padding: 0.5rem 1.25rem;
  border-radius: var(--radius-md);
}

.ab-results__pipeline-badge--a {
  background: var(--color-accent);
  color: white;
}

.ab-results__pipeline-badge--b {
  background: #6366F1;
  color: white;
}

.ab-results__pipeline-calls {
  font-size: 0.75rem;
  color: var(--color-text-muted);
}

.ab-results__vs {
  font-size: 1rem;
  font-weight: 600;
  color: var(--color-text-muted);
}

.ab-results__metrics {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
  gap: var(--spacing-md);
}

/* Metric Card */
.ab-metric-card {
  background: var(--color-bg);
  border: 1px solid var(--color-border);
  border-radius: var(--radius-lg);
  overflow: hidden;
}

.ab-metric-card__header {
  display: flex;
  align-items: center;
  gap: var(--spacing-xs);
  padding: 0.75rem 1rem;
  background: var(--color-bg-subtle);
  border-bottom: 1px solid var(--color-border);
  font-size: 0.875rem;
  font-weight: 600;
  color: var(--color-text);
}

.ab-metric-card__header svg {
  color: var(--color-text-muted);
}

.ab-metric-card__content {
  padding: var(--spacing-md);
  display: flex;
  flex-direction: column;
  gap: var(--spacing-sm);
}

.ab-metric-card__detail {
  padding-top: var(--spacing-sm);
  border-top: 1px solid var(--color-border);
}

.ab-metric-card__detail-row {
  display: flex;
  justify-content: space-between;
  font-size: 0.8125rem;
  font-family: var(--font-mono);
  color: var(--color-text-secondary);
}

.ab-metric-card__detail-label {
  font-size: 0.75rem;
  color: var(--color-text-muted);
  margin-top: 0.25rem;
}

.ab-metric-card__totals {
  display: flex;
  justify-content: space-around;
  padding-top: var(--spacing-sm);
  border-top: 1px solid var(--color-border);
}

.ab-metric-card__total {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 0.125rem;
}

.ab-metric-card__total-label {
  font-size: 0.625rem;
  text-transform: uppercase;
  color: var(--color-text-muted);
}

.ab-metric-card__total-value {
  font-size: 0.875rem;
  font-weight: 600;
  font-family: var(--font-mono);
  color: var(--color-text);
}

.ab-metric-card__scores {
  display: flex;
  justify-content: space-around;
  padding-top: var(--spacing-sm);
  border-top: 1px solid var(--color-border);
}

.ab-metric-card__score {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 0.125rem;
}

.ab-metric-card__score-value {
  font-size: 1rem;
  font-weight: 700;
  font-family: var(--font-mono);
}

.ab-metric-card__score-value--a {
  color: var(--color-accent);
}

.ab-metric-card__score-value--b {
  color: #6366F1;
}

.ab-metric-card__score-label {
  font-size: 0.625rem;
  text-transform: uppercase;
  color: var(--color-text-muted);
}

.ab-metric-card__empty {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: var(--spacing-xs);
  padding: var(--spacing-md);
  color: var(--color-text-muted);
  font-size: 0.8125rem;
}

/* ========================================
   NEW VISUALIZATION COMPONENTS
   ======================================== */


/* Circular Score */
.ab-circle-score {
  position: relative;
  width: 80px;
  height: 80px;
  display: flex;
  align-items: center;
  justify-content: center;
}

.ab-circle-score__svg {
  transform: rotate(-90deg);
  width: 100%;
  height: 100%;
}

.ab-circle-score__track {
  fill: none;
  stroke: var(--color-border);
  stroke-width: 6;
}

.ab-circle-score__fill {
  fill: none;
  stroke-width: 6;
  stroke-linecap: round;
  transition: stroke-dashoffset 0.8s ease-out;
}

.ab-circle-score--a .ab-circle-score__fill {
  stroke: var(--color-accent);
}

.ab-circle-score--b .ab-circle-score__fill {
  stroke: #6366F1;
}

.ab-circle-score__content {
  position: absolute;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 0;
}

.ab-circle-score__value {
  font-size: 1rem;
  font-weight: 700;
  color: var(--color-text);
  line-height: 1;
}

.ab-circle-score__label {
  font-size: 0.625rem;
  font-weight: 600;
  color: var(--color-text-muted);
  text-transform: uppercase;
}

/* Winner Badge */
.ab-winner-badge {
  display: inline-flex;
  align-items: center;
  gap: 0.25rem;
  padding: 0.125rem 0.5rem;
  border-radius: 999px;
  font-size: 0.625rem;
  font-weight: 600;
  margin-left: auto;
}

.ab-winner-badge--a {
  background: rgba(16, 185, 129, 0.15);
  color: #10B981;
}

.ab-winner-badge--b {
  background: rgba(99, 102, 241, 0.15);
  color: #6366F1;
}

/* Stat Row */
.ab-stat-row {
  display: grid;
  grid-template-columns: 1fr 1fr 1fr;
  gap: var(--spacing-sm);
  padding: 0.5rem 0;
  border-bottom: 1px solid var(--color-border-subtle);
}

.ab-stat-row--with-diff {
  grid-template-columns: 1.2fr 1fr 1fr 0.8fr;
}

.ab-stat-row:last-child {
  border-bottom: none;
}

.ab-stat-row__label {
  font-size: 0.8125rem;
  color: var(--color-text-secondary);
}

.ab-stat-row__value {
  font-size: 0.8125rem;
  font-family: var(--font-mono);
  font-weight: 500;
  text-align: right;
}

.ab-stat-row__value--a {
  color: var(--color-text);
}

.ab-stat-row__value--b {
  color: var(--color-text);
}

.ab-stat-row__value--winner {
  color: #10B981;
  font-weight: 600;
}

.ab-stat-row__diff {
  font-size: 0.75rem;
  font-weight: 500;
  text-align: right;
  color: var(--color-text-muted);
}

.ab-stat-row__diff--good {
  color: #10B981;
}

.ab-stat-row__diff--bad {
  color: #EF4444;
}

/* ========================================
   RESULTS LAYOUT - NEW DESIGN
   ======================================== */

.ab-results__header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding-bottom: var(--spacing-md);
  border-bottom: 1px solid var(--color-border);
  margin-bottom: var(--spacing-lg);
}

.ab-results__title {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  font-size: 1.125rem;
  font-weight: 600;
  color: var(--color-text);
}

.ab-results__title svg {
  color: #10B981;
}

.ab-results__pipelines {
  display: flex;
  align-items: center;
  gap: var(--spacing-sm);
}

.ab-results__pipeline {
  display: flex;
  align-items: center;
  gap: 0.375rem;
}

.ab-results__pipeline-label {
  width: 24px;
  height: 24px;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: var(--radius-sm);
  font-size: 0.75rem;
  font-weight: 700;
}

.ab-results__pipeline-label--a {
  background: var(--color-accent);
  color: white;
}

.ab-results__pipeline-label--b {
  background: #6366F1;
  color: white;
}

.ab-results__pipeline-count {
  font-size: 0.8125rem;
  color: var(--color-text-secondary);
}

.ab-results__vs {
  font-size: 0.75rem;
  font-weight: 500;
  color: var(--color-text-muted);
}

/* Results Sections */
.ab-results__section {
  margin-bottom: var(--spacing-lg);
}

.ab-results__section-title {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  font-size: 0.875rem;
  font-weight: 600;
  color: var(--color-text);
  margin: 0 0 var(--spacing-md) 0;
}

.ab-results__section-title svg {
  color: var(--color-text-muted);
}

/* Performance Grid */
.ab-results__perf-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
  gap: var(--spacing-md);
}

.ab-results__perf-card {
  background: var(--color-bg-secondary);
  border: 1px solid var(--color-border);
  border-radius: var(--radius-lg);
  padding: var(--spacing-md);
}

.ab-results__perf-header {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  font-size: 0.8125rem;
  font-weight: 600;
  color: var(--color-text);
  margin-bottom: var(--spacing-md);
}

.ab-results__perf-header svg {
  color: var(--color-text-muted);
}

.ab-results__vbar-group {
  display: flex;
  justify-content: space-around;
  gap: var(--spacing-md);
}

/* Cost Comparison */
.ab-results__cost-comparison {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: var(--spacing-sm);
  margin-bottom: var(--spacing-sm);
}

.ab-results__cost-item {
  padding: var(--spacing-sm);
  border-radius: var(--radius-md);
  text-align: center;
}

.ab-results__cost-item--a {
  background: rgba(16, 185, 129, 0.08);
  border: 1px solid rgba(16, 185, 129, 0.2);
}

.ab-results__cost-item--b {
  background: rgba(99, 102, 241, 0.08);
  border: 1px solid rgba(99, 102, 241, 0.2);
}

.ab-results__cost-label {
  display: block;
  font-size: 0.6875rem;
  font-weight: 500;
  color: var(--color-text-muted);
  margin-bottom: 0.25rem;
}

.ab-results__cost-value {
  font-size: 1.25rem;
  font-weight: 700;
  font-family: var(--font-mono);
  color: var(--color-text);
}

.ab-results__cost-savings {
  text-align: center;
  font-size: 0.75rem;
  font-weight: 600;
  color: #10B981;
  padding: 0.25rem 0.75rem;
  background: rgba(16, 185, 129, 0.1);
  border-radius: var(--radius-full);
  display: inline-block;
  margin: 0 auto;
  width: fit-content;
}

/* Generic Table */
.ab-results__table {
  background: var(--color-bg);
  border: 1px solid var(--color-border-subtle);
  border-radius: var(--radius-md);
  padding: var(--spacing-sm) var(--spacing-md);
}

.ab-results__table-header {
  display: grid;
  grid-template-columns: 1.2fr 1fr 1fr 0.8fr;
  gap: var(--spacing-sm);
  padding-bottom: 0.5rem;
  border-bottom: 1px solid var(--color-border);
  margin-bottom: 0.25rem;
}

.ab-results__table-header span {
  font-size: 0.6875rem;
  font-weight: 600;
  text-transform: uppercase;
  color: var(--color-text-muted);
  text-align: right;
}

.ab-results__table-header span:first-child {
  text-align: left;
}

.ab-results__table-col-a {
  color: var(--color-accent) !important;
}

.ab-results__table-col-b {
  color: #6366F1 !important;
}

/* Tokens Table */
.ab-results__tokens-table {
  background: var(--color-bg-secondary);
  border: 1px solid var(--color-border);
  border-radius: var(--radius-lg);
  padding: var(--spacing-md);
}

.ab-results__tokens-header {
  display: grid;
  grid-template-columns: 1fr 1fr 1fr;
  gap: var(--spacing-sm);
  padding-bottom: 0.5rem;
  border-bottom: 1px solid var(--color-border);
  margin-bottom: 0.5rem;
}

.ab-results__tokens-header span {
  font-size: 0.6875rem;
  font-weight: 600;
  text-transform: uppercase;
  color: var(--color-text-muted);
  text-align: right;
}

.ab-results__tokens-header span:first-child {
  text-align: left;
}

.ab-results__tokens-col-a {
  color: var(--color-accent) !important;
}

.ab-results__tokens-col-b {
  color: #6366F1 !important;
}

.ab-results__tokens-total {
  margin-top: 0.5rem;
  padding-top: 0.5rem;
  border-top: 1px solid var(--color-border);
}

.ab-results__tokens-total .ab-stat-row__label {
  font-weight: 600;
}

/* Quality Grid */
.ab-results__quality-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: var(--spacing-md);
}

.ab-results__quality-card {
  background: var(--color-bg-secondary);
  border: 1px solid var(--color-border);
  border-radius: var(--radius-lg);
  padding: var(--spacing-md);
  text-align: center;
}

.ab-results__quality-header {
  font-size: 0.8125rem;
  font-weight: 600;
  color: var(--color-text);
  margin-bottom: var(--spacing-md);
}

.ab-results__circles {
  display: flex;
  justify-content: center;
  gap: var(--spacing-lg);
}

.ab-results__no-data {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 0.5rem;
  padding: var(--spacing-md);
  color: var(--color-text-muted);
  font-size: 0.8125rem;
}

/* Insights */
.ab-results__insights {
  background: var(--color-bg-subtle);
  border: 1px solid var(--color-border);
  border-radius: var(--radius-lg);
  padding: var(--spacing-md);
}

.ab-results__insight-list {
  display: flex;
  flex-direction: column;
  gap: var(--spacing-xs);
}

.ab-results__insight {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  padding: 0.5rem 0.75rem;
  background: var(--color-bg);
  border: 1px solid var(--color-border);
  border-radius: var(--radius-md);
  font-size: 0.8125rem;
  color: var(--color-text-secondary);
}

.ab-results__insight svg {
  flex-shrink: 0;
  color: var(--color-text-muted);
}

.ab-results__insight--a {
  border-left: 3px solid var(--color-accent);
}

.ab-results__insight--b {
  border-left: 3px solid #6366F1;
}

.ab-results__insight strong {
  color: var(--color-text);
}

/* Test Summary Metrics */
.ab-test-summary__metrics {
  margin-top: var(--spacing-sm);
  padding-top: var(--spacing-sm);
  border-top: 1px solid var(--color-border);
}

.ab-test-summary__metrics-label {
  font-size: 0.75rem;
  color: var(--color-text-muted);
  margin-right: var(--spacing-xs);
}

.ab-test-summary__metrics-list {
  display: flex;
  flex-wrap: wrap;
  gap: 0.375rem;
  margin-top: 0.375rem;
}

.ab-test-summary__metric-tag {
  font-size: 0.6875rem;
  font-weight: 500;
  color: var(--color-text);
  background: var(--color-bg-subtle);
  padding: 0.25rem 0.5rem;
  border-radius: var(--radius-sm);
  border: 1px solid var(--color-border);
}

/* ========================================
   NAVIGATION
   ======================================== */

.ab-navigation {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding-top: var(--spacing-md);
  border-top: 1px solid var(--color-border);
}

.ab-navigation__left,
.ab-navigation__right {
  display: flex;
  align-items: center;
  gap: var(--spacing-xs);
}

.ab-nav-button {
  display: flex;
  align-items: center;
  gap: 0.375rem;
  padding: 0.625rem 1rem;
  font-size: 0.8125rem;
  font-weight: 500;
  font-family: inherit;
  border-radius: var(--radius-md);
  cursor: pointer;
  transition: all var(--transition-fast);
}

.ab-nav-button--primary {
  background: var(--color-accent);
  border: 1px solid var(--color-accent);
  color: white;
}

.ab-nav-button--primary:hover:not(:disabled) {
  background: var(--color-accent-hover);
  border-color: var(--color-accent-hover);
  transform: translateY(-1px);
}

.ab-nav-button--primary:disabled {
  background: var(--color-border);
  border-color: var(--color-border);
  color: var(--color-text-muted);
  cursor: not-allowed;
}

.ab-nav-button--secondary {
  background: var(--color-bg);
  border: 1px solid var(--color-border);
  color: var(--color-text-secondary);
}

.ab-nav-button--secondary:hover {
  background: var(--color-bg-subtle);
  border-color: var(--color-text-muted);
}

.ab-nav-button--reset {
  background: transparent;
  border: 1px solid transparent;
  color: var(--color-text-muted);
}

.ab-nav-button--reset:hover {
  color: var(--color-text);
  background: var(--color-bg-subtle);
}

/* ========================================
   RESPONSIVE
   ======================================== */

/* Responsive: Tablet and below */
@media (max-width: 900px) {
  .ab-testing-layout {
    grid-template-columns: 1fr;
    grid-template-rows: auto 1fr auto;
    height: auto;
    min-height: auto;
    max-height: none;
  }

  .ab-sidebar {
    grid-row: 1;
    border-right: none;
    border-bottom: 1px solid var(--color-border);
  }

  .ab-sidebar__header {
    display: none;
  }

  .ab-sidebar__nav {
    display: flex;
    flex-direction: row;
    overflow-x: auto;
    padding: var(--spacing-xs);
    gap: 0.25rem;
  }

  .ab-sidebar__step {
    flex-direction: column;
    padding: 0.5rem 0.75rem;
    min-width: 70px;
    text-align: center;
    margin-bottom: 0;
  }

  .ab-sidebar__step-content {
    display: none;
  }

  .ab-sidebar__step-indicator {
    display: none;
  }

  .ab-sidebar__status {
    display: none;
  }

  .ab-main {
    grid-row: 2;
  }

  .ab-main__content {
    padding: var(--spacing-md);
    max-height: 55vh;
    overflow-y: auto;
  }

  .ab-bottom-nav {
    grid-column: 1;
    grid-row: 3;
  }
}

@media (max-width: 1024px) {
  .ab-pipelines-grid {
    grid-template-columns: 1fr;
  }

  .ab-pipelines-divider {
    flex-direction: row;
    padding: var(--spacing-sm);
  }

  .ab-test-summary__grid {
    grid-template-columns: repeat(2, 1fr);
  }

  .ab-test-result__summary {
    grid-template-columns: repeat(2, 1fr);
  }

  .ab-group-card__stats-row {
    grid-template-columns: repeat(2, 1fr);
  }

  .ab-group-card__traces-comparison {
    grid-template-columns: 1fr;
  }

  .ab-prompt-group__comparison-stats {
    grid-template-columns: repeat(2, 1fr);
  }

  .ab-prompt-group__instances {
    grid-template-columns: 1fr;
  }
}

@media (max-width: 768px) {
  .ab-testing__header {
    padding: var(--spacing-sm) var(--spacing-md);
  }

  .ab-stepper {
    padding: var(--spacing-sm);
    gap: 0.5rem;
  }

  .ab-stepper__step {
    flex-direction: column;
    align-items: center;
    text-align: center;
  }

  .ab-stepper__connector {
    display: none;
  }

  .ab-stepper__desc {
    display: none;
  }

  .ab-stepper__indicator {
    width: 24px;
    height: 24px;
    font-size: 0.6875rem;
  }

  .ab-stepper__label {
    font-size: 0.6875rem;
  }

  .ab-groups-header {
    flex-direction: column;
    align-items: stretch;
  }

  .ab-groups-search {
    max-width: none;
  }

  .ab-groups-actions {
    justify-content: space-between;
  }

  .ab-evals-grid {
    grid-template-columns: 1fr;
  }

  .ab-group-card__pipeline-traces {
    grid-template-columns: 1fr;
  }

  .ab-group-card__stats-row {
    grid-template-columns: 1fr 1fr;
    padding: var(--spacing-sm);
    gap: var(--spacing-xs);
  }

  .ab-group-card__stat {
    padding: 0.5rem;
  }

  .ab-group-card__stat-label {
    font-size: 0.5625rem;
  }

  .ab-group-card__stat-value {
    font-size: 0.75rem;
  }

  .ab-group-card__traces-comparison {
    padding: var(--spacing-sm);
    gap: var(--spacing-sm);
  }

  .ab-group-card__traces-list {
    max-height: 300px;
  }

  .ab-trace-detail__header {
    flex-wrap: wrap;
    gap: 0.5rem;
  }

  .ab-trace-detail__meta {
    width: 100%;
    justify-content: flex-end;
  }

  .ab-prompt-group__header {
    flex-wrap: wrap;
    gap: 0.5rem;
  }

  .ab-prompt-group__stats {
    width: 100%;
    justify-content: flex-start;
  }

  .ab-prompt-group__comparison-stats {
    grid-template-columns: 1fr 1fr;
    padding: var(--spacing-sm);
    gap: var(--spacing-xs);
  }

  .ab-prompt-group__cstat {
    padding: 0.5rem;
  }

  .ab-prompt-group__cstat-label {
    font-size: 0.5rem;
  }

  .ab-prompt-group__cstat-value {
    font-size: 0.75rem;
  }

  .ab-prompt-group__instances {
    padding: var(--spacing-sm);
    gap: var(--spacing-sm);
  }

  .ab-prompt-group__col-list {
    max-height: 300px;
  }

  .ab-instance-item__text {
    font-size: 0.625rem;
  }
}

@media (max-width: 480px) {
  .ab-testing__title h3 {
    font-size: 0.9375rem;
  }

  .ab-testing__desc {
    font-size: 0.8125rem;
  }

  .ab-pipeline-selector {
    padding: var(--spacing-sm);
  }

  .ab-pipeline-selector__labels {
    gap: 0.375rem;
  }

  .ab-label-filter__trigger {
    padding: 0.25rem 0.5rem;
    font-size: 0.6875rem;
  }

  .ab-test-summary__grid {
    grid-template-columns: 1fr;
  }

  .ab-test-result__summary {
    grid-template-columns: 1fr 1fr;
  }

  .ab-run-button {
    padding: 0.75rem var(--spacing-md);
    font-size: 0.875rem;
  }

  .ab-nav-button {
    padding: 0.5rem 0.75rem;
    font-size: 0.75rem;
  }
}
